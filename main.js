(()=>{"use strict";var e=document.querySelector("#card-template").content,t=document.querySelector(".places__list");function n(t,n,o,r){var c=e.querySelector(".places__item").cloneNode(!0),u=c.querySelector(".card__delete-button"),a=c.querySelector(".card__like-button"),i=c.querySelector(".card__image"),p=c.querySelector(".card__like-button-counter");c.querySelector(".card__image").src=t.link,c.querySelector(".card__image").alt=t.name,c.querySelector(".card__title").textContent=t.name,u.addEventListener("click",(function(){return setTimeout((function(){n()}),1)})),i.addEventListener("click",(function(){return setTimeout((function(){r()}),1)})),a.addEventListener("click",o);var l=!1;return a.addEventListener("click",(function(){var e=parseInt(p.textContent,10);p.style.display="block"===p.style.display?"none":"block",l?(l=!1,p.textContent=e-1):(l=!0,p.textContent=e+1)})),c}var o=function(e){e.target.classList.toggle("card__like-button_is-active")};function r(e){e.target.closest(".places__item").remove()}fetch("https://nomoreparties.co/v1/wff-cohort-5/cards",{headers:{authorization:"08362937-4744-48bc-93fa-07b20c8f7a3b"}}).then((function(e){return e.json()})).then((function(e){console.log(e)}));var c="https://nomoreparties.co/v1/wff-cohort-5",u=function(){return fetch("".concat(c,"/cards"),{method:"GET",headers:{authorization:"08362937-4744-48bc-93fa-07b20c8f7a3b","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},a=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__error_visible"),n.textContent=""};function i(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("popup__button_disabled"),t.disabled=!1):(t.classList.add("popup__button_disabled"),t.disabled=!0)}var p=function(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),100),document.addEventListener("keydown",s)},l=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)},s=function(e){"Escape"===e.code&&l(document.querySelector(".popup_is-opened"))},d=function(e){e.target===e.currentTarget&&l(document.querySelector(".popup_is-opened"))},_=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),y=document.querySelector(".popup__image"),v=document.querySelector(".popup__caption"),S=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),q=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),E=document.querySelector(".popup__input_type_name"),L=document.querySelector(".popup__input_type_description"),C=document.querySelectorAll(".popup__close"),x=(document.querySelector(".popup__button"),function(e){p(b),y.src=e.target.src,y.alt=e.target.alt,v.textContent=e.target.alt});document.querySelector('form[name="edit-profile"]').addEventListener("submit",(function(e){e.preventDefault();var t=E.value,n=L.value,o=document.querySelector(".profile__title"),r=document.querySelector(".profile__description");o.textContent=t,r.textContent=n,E.value="",L.value="",Promise.all(getUserInfo()).then((function(e){o.textContent=e.popupName,r.textContent=e.job})).catch((function(e){console.log("Ошибка ошибка: ".concat(e.message))})),l(q)}));var j=document.querySelector('form[name="new-place"]'),A=j.querySelector(".popup__input_type_card-name"),T=j.querySelector(".popup__input_type_url");j.addEventListener("submit",(function(e){e.preventDefault();var t={name:A.value,link:T.value};A.value="",T.value="";var c=n(t,r,o,x);_.prepend(c),l(h)})),C.forEach((function(e){e.addEventListener("click",(function(e){l(e.target.closest(".popup"))}))})),S.forEach((function(e){e.addEventListener("click",d)})),f.addEventListener("click",(function(){p(q),E.setAttribute("value",g.textContent),L.setAttribute("value",k.textContent)})),m.addEventListener("click",(function(e){e.preventDefault(),p(h)})),[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}].forEach((function(e){!function(e){t.append(e)}(n(e,r,o,x))}));var w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:".popup__button_disabled",inputErrorClass:".popup__input_type_error",errorClass:".popup__error_visible"};!function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(e){var t,n,o;t=e,n=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector(".popup__button"),i(n,o),n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?a(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__error_visible")}(e,t,t.validationMessage)}(t,e),i(n,o)}))}))}))}(w);var z=document.querySelector(".profile__image"),D=document.querySelector(".popup_type_change_avatar"),P=D.querySelector(".popup__close"),I=document.querySelector('form[name="new-avatar"]'),N=I.querySelector(".popup__input_type_url"),O=D.querySelector(".popup__button");z.addEventListener("click",(function(){p(D)})),P.addEventListener("click",(function(){l(D)})),I.addEventListener("submit",(function(e){e.preventDefault();var t=O.textContent;O.textContent="Сохранение...";var n,o=N.value;z.style.backgroundImage=o,(n=o,fetch("".concat(c,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"08362937-4744-48bc-93fa-07b20c8f7a3b","Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(e){return e.json()})).catch((function(e){console.log(e)}))).then((function(e){z.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})).finally((function(){return O.textContent=t})),l(D),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));i(n,e.querySelector(t.submitButtonSelector)),n.forEach((function(t){a(e,t)}))}(I,w)})),b.addEventListener("submit",(function(e){e.preventDefault(),fetch("".concat(c,"/cards"),{method:"POST",headers:{authorization:"08362937-4744-48bc-93fa-07b20c8f7a3b","Content-Type":"application/json"},body:JSON.stringify({name:undefined,link:undefined})}).then((function(e){return e.ok?e.json():(console.log("error"),Promise.reject("error: ".concat(e.status)))})).catch((function(e){console.log("ERROR:",e)})).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){_.append(n(e.name,e.link,r,o)),console.log("".concat(e.link))}))})).catch((function(e){console.log("Ошибка добавления",e)}))})),u().then((function(e){console.log(e),e.forEach((function(e){_.append(n(e.name,e.link,r,o)),console.log("".concat(e.link))}))})),b.addEventListener("submit",u)})();